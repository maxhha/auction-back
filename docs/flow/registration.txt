// Powered by https://swimlanes.io
title: Регистрация пользователя

order: Manager, Client, Server, DB

_: **1. Создание гостя**

Client -> Server: `register`

note:
**regitster** создает нового User в базеданных

Server --> DB: INSERT INTO user

note:
_удалить запись гостя из бд через 4 часа, если он окончательно не зарегистрируется_

Server <-- DB: `id`

Client <- Server: JWT token

_: **2. Заполнение анкеты**

Client -> Server: `requestSetUserEmail`

Server --> DB: INSERT INTO tokens

Server <-- DB: `token`

Server --> Client: Send token to email

Client -> Server: `approveSetUserEmail(token)`

if: Если анекты еще нет в бд
  Server --> DB: INSERT INTO user_forms
  Server <-- DB: `id`
end

Server --> DB: UPDATE user_forms SET email

DB --> Server: Updated

Server -> Client: Updated UserForm

--: Аналогично для `requestSetUserPhone`

Client -> Server: `updateUserPassword`

note:
Установка начального пароля

Server --> DB: UPDATE user_forms SET password

Server <-- DB: Updated

Server -> Client: Updated UserForm

// TODO: add setUserName

_: **3. Модерация анкеты**

Client -> Server: `requestModerateUserForm`

Server --> DB: INSERT INTO tokens
Server <-- DB: `token`
Client <-- Server: Send token through email or phone
Client -> Server: `approveModerateUserForm(token)`
Server --> DB: UPDATE user_forms SET state
Server <-- DB: Updated
Client <- Server: Updated UserForm

...: Менеджер приступил к подтвержению анкет

Manager <- Server: userForms

if: Анкета заполнена правильно

Manager -> Server: `approveUserForm`
Server --> DB: UPDATE user_forms SET state
Server <-- DB: Updated
Server --> Client: Send email
Server --> Manager: Updated UserForm

else: В анкете существуют ошибки или неточности

Manager -> Server: `declineUserForm`
Server --> DB: UPDATE user_forms SET state
Server <-- DB: Updated
Server --> Client: Send email
Server --> Manager: Updated UserForm

...: Клиент должен изменить информацию в анкете и отправить ее на повторную модерацию

end